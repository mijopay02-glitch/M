<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscription Affilié MIJO</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .container {
            text-align: center;
            padding: 20px;
        }
        .flyer-container {
            margin-bottom: 20px;
        }
        .flyer-container img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
        }
        .inscription-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .option-box {
            background-color: #f0f0f0;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #ddd;
        }
        .option-box h2 {
            margin-top: 0;
        }
        .option-box button {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }
        #parrain-section button {
            background-color: #4CAF50; /* Vert */
        }
        #no-parrain-section button {
            background-color: #2196F3; /* Bleu */
        }
        #parrain-code-input {
            width: calc(100% - 22px);
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .info-buttons {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
}
.info-btn {
    padding: 10px 15px;
    border-radius: 5px;
    border: 1px solid #ccc;
    background-color: #f9f9f9;
    cursor: pointer;
    text-decoration: none;
    color: black;
}
.whatsapp-btn {
    background-color: #25D366;
    color: white;
    border: none;
}
.modal {
    display: none; /* Caché par défaut */
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.4);
    justify-content: center;
    align-items: center;
}
.modal-content {
    background-color: #fff;
    padding: 20px;
    border-radius: 10px;
    max-width: 80%;
}
.close-btn {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}
        .spinner-border {
  display: inline-block;
  width: 2rem;
  height: 2rem;
  vertical-align: -0.125em;
  border: 0.25em solid currentColor;
  border-right-color: transparent;
  border-radius: 50%;
  -webkit-animation: .75s linear infinite spinner-border;
  animation: .75s linear infinite spinner-border;
}

@keyframes spinner-border {
  to {
    transform: rotate(360deg);
  }
}

.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}
    </style>
</head>
<body>
    <div class="container">
        <h1>MIJO Affiliate Promo</h1>
        <div class="flyer-container">
    <img src="https://i.postimg.cc/zD2qnm1G/a-vibrant-lifestyle-advertisement-for-th-1-VHg-Mv6-PQV-y-fa-I6d-XWi-A-31-Eg-LM5-MT3-Cf-E5-Rp-Cw0v-ZA.jpg" alt="Flyer de promotion MIJO Affiliate">
</div>
        <div class="info-buttons">
    <button id="info-btn" class="info-btn">Infos sur le programme</button>
    <a href="https://wa.me/50944990203?text=J'ai besoin d'aide pour m'inscrire au programme d'affiliation MIJO." target="_blank" class="info-btn whatsapp-btn">
        Besoin d'aide ?
    </a>
</div>

<div id="infoModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <h2>MIJO Affiliate Promo</h2>
        <p> Fè Lajan ak MIJO Affiliate Promo! </p>
        <p>Èske w ta renmen fè lajan fasil, san w pa bezwen yon gwo envèstisman? MIJO Affiliate Promo se chwa pou ou! Se yon pwogram kote ou vin yon patnè ofisyèl MIJO epi ou touche komisyon chak fwa yon moun enskri ak kòd pa w.

Kòman sa Fonksyone?

Enskripsyon: Enskri nan pwogram nan pou w vin yon afilye. Pri a varye ant 750 Gdes ak 1000 Gdes, selon si w gen yon parrain oubyen ou enskri poukont ou.

Jwenn Kòd Pa w: Yon fwa w enskri, n ap ba w yon kòd parrainage pèsonèl.

Pataje Kòd la: Pataje kòd sa a ak fanmi w, zanmi w ak sou rezo sosyal yo. Ankouraje moun enskri ak kòd pa w pou yo ka jwenn aksè nan tout sèvis MIJO.

Touche Komisyon: Chak fwa yon moun enskri ak kòd pa w, ou touche yon gwo komisyon! Nou ba w 60% sou kòb enskripsyon an. Sa vle di, ou ka touche jiska 600 Gdes sou chak moun!

Poukisa pou w Chwazi MIJO Affiliate Promo?

Fasil: Pa gen anyen konplike! Se jis pataje kòd ou epi gade kòb antre.

Gwo Komisyon: Nou ba w pi gwo pousantaj komisyon sou mache a.

Zouti Marketing: N ap ba w tout zouti ou bezwen pou w byen vann: flyer, afich, tèks piblisite, ak lòt resous pou w pataje sou WhatsApp ak rezo sosyal yo.

Kategori: Selon kantite moun ou afilye, w ap monte nan kategori (Bronze, Argent, Gold) epi w ap jwenn plis avantaj.

Pa pèdi tan! Vin yon afilye MIJO jodi a epi kòmanse fè lajan an gwo!</p>
    </div>
</div>

        <div class="inscription-options">
            <div id="spinner" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.8); z-index: 9999; justify-content: center; align-items: center;">
    <div class="spinner-border text-primary" role="status">
        <span class="sr-only">Chargement...</span>
    </div>
</div>
            <div class="option-box" id="parrain-section">
                <h2>Inscription avec parrain</h2>
                <p>Coût : 750 Gdes</p>
                <input type="text" id="parrain-code-input" placeholder="Entrez le code de parrainage">
                <button id="parrain-btn">S'inscrire avec ce parrain</button>
            </div>
            
            <div class="option-box" id="no-parrain-section">
                <h2>Inscription sans parrain</h2>
                <p>Coût : 1000 Gdes</p>
                <button id="no-parrain-btn">S'inscrire sans parrain</button>
            </div>
        </div>
    </div>
    
    <script>
        
        // Fonctions pour afficher et masquer le spinner
function showSpinner() {
    document.getElementById('spinner').style.display = 'flex';
}

function hideSpinner() {
    document.getElementById('spinner').style.display = 'none';
}
document.getElementById('info-btn').addEventListener('click', () => {
    document.getElementById('infoModal').style.display = 'flex';
});

// Cachez la modale
function closeModal() {
    document.getElementById('infoModal').style.display = 'none';
}
        
    const parrainBtn = document.getElementById('parrain-btn');
    const noParrainBtn = document.getElementById('no-parrain-btn');
    const parrainCodeInput = document.getElementById('parrain-code-input');
    // REMPLACEZ LES URL CI-DESSOUS PAR CELLES DE VOS WORKERS
    const parrainUrl = "https://inscriptionavecparain.mijocomplexe.workers.dev/"; 
    const noParrainUrl = "https://noparrain.mijocomplexe.workers.dev/"; 

    // Gérer l'inscription avec parrain
    parrainBtn.addEventListener('click', async () => {
    const parrainCode = parrainCodeInput.value.trim();
    if (parrainCode === "") {
        alert("Veuillez entrer le code de parrainage.");
        return;
    }

    const userString = localStorage.getItem('user');
    const user = JSON.parse(userString);
    
    if (!user || !user.userId) {
        alert("Utilisateur non connecté ou données manquantes.");
        return;
    }
    
    if (user.Solde < 750) {
        alert("Solde insuffisant pour une inscription avec parrain (750 Gdes).");
        return;
    }

    // Afficher le spinner et le message de chargement
    showSpinner();
    alert("Traitement en cours... Veuillez patienter.");

    // Créer un objet de données à envoyer
    const dataToSend = {
        userId: user.userId,
        lienAffiliation: parrainCode
    };

    try {
        const response = await fetch(parrainUrl, {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json' 
            },
            body: JSON.stringify(dataToSend)
        });

        hideSpinner(); // Masquer le spinner après la réponse du serveur

        if (!response.ok) {
            let errorText = `Erreur du serveur: ${response.status} ${response.statusText}`;
            try {
                const errorData = await response.json();
                errorText = errorData.error || errorText;
            } catch (e) {
                // Si la réponse n'est pas en JSON, on utilise le message par défaut
            }
            alert(errorText);
            return;
        }

        const responseText = await response.text();
        if (!responseText) {
            alert("Erreur: La réponse du serveur est vide.");
            return;
        }

        let result;
        try {
            result = JSON.parse(responseText);
        } catch (e) {
            alert("Erreur: La réponse du serveur n'est pas au format JSON.");
            return;
        }

        if (result.success) {
            user.Solde = result.nouveauSolde;
            user.Estafilia = true;
            user.LienAffiliation = result.LienAffiliation;
            localStorage.setItem('user', JSON.stringify(user));
            saveToHistory("Affiliation avec parrain", 750, "Succès", user.userId);
            
            alert(result.message || "Inscription avec parrain réussie ! Vous êtes maintenant un affilié.");
            window.location.href = 'mijo-affiliate-promo.html';
        } else {
            alert(result.error || "Échec de l'inscription avec parrain. Le code est peut-être invalide.");
        }
    } catch (error) {
        hideSpinner(); // Masquer le spinner en cas d'erreur de connexion
        alert("Erreur de connexion. Veuillez réessayer plus tard.");
        console.error("Erreur de fetch:", error);
    }
});
    // Gérer l'inscription sans parrain
    noParrainBtn.addEventListener('click', async () => {
        const userString = localStorage.getItem('user');
        const user = JSON.parse(userString);

        if (!user || !user.userId) {
            alert("Utilisateur non connecté ou données manquantes.");
            return;
        }

        if (user.Solde < 1000) {
            alert("Solde insuffisant pour une inscription sans parrain (1000 Gdes).");
            return;
        }

        alert("Traitement en cours... Veuillez patienter.");

        const dataToSend = {
            userId: user.userId
        };
        
        try {
            const response = await fetch(noParrainUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dataToSend)
            });
            const result = await response.json();

            if (result.success) {
                user.Solde = result.nouveauSolde;
                user.Estafilia = true;
                user.LienAffiliation = result.LienAffiliation;
                localStorage.setItem('user', JSON.stringify(user));
                saveToHistory("Affiliation sans parrain", 1000, "Succès", user.userId);
                
                alert("Inscription sans parrain réussie ! Vous êtes maintenant un affilié.");
                window.location.href = 'mijo-affiliate-promo.html';
            } else {
                alert(result.error || "Échec de l'inscription sans parrain.");
            }
        } catch (error) {
            alert("Erreur de connexion. Veuillez réessayer plus tard.");
        }

        
        function saveToHistory(type, description, amount, status, userId) {
    const historyKey = `transactions_${userId}`;
    let history = JSON.parse(localStorage.getItem(historyKey)) || [];
    const newTransaction = {
        id: Date.now(),
        type: type, // Par exemple, "Achat", "Transfert", "Affiliation"
        description: description, // Le nom du produit ou du service
        amount: amount,
        status: status, // Par exemple, "Succès", "Échec", "Envoyé"
        date: new Date().toLocaleDateString()
    };
    history.push(newTransaction);
    localStorage.setItem(historyKey, JSON.stringify(history));
}
    });

    </script>
</body>
</html>
