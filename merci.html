<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Merci pour votre paiement</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      text-align: center;
      padding: 100px;
    }
    h1 {
      color: #28a745;
      font-size: 36px;
    }
    p {
      font-size: 18px;
      color: #333;
    }
    .balance-display {
      font-weight: bold;
      color: #0099ff;
      margin-top: 15px;
      font-size: 20px;
    }
    a {
      display: inline-block;
      margin-top: 30px;
      padding: 12px 25px;
      background: #0099ff;
      color: #fff;
      text-decoration: none;
      border-radius: 5px;
      font-size: 16px;
    }
    a:hover { background: #007acc; }
  </style>
</head>
<body>

  <h1>Paiement réussi ✅</h1>
  <p>Merci d’avoir utilisé MIJO PAY !</p>
  <p>Votre paiement a été reçu et est en cours de traitement.</p>
  <p id="statusMessage" class="balance-display"></p>

  <a href="home.html">Retour à l’accueil</a>

  <script>
    function updateBalanceFromUrl() {
      // Récupérer le solde de l'URL
      const urlParams = new URLSearchParams(window.location.search);
      const newSolde = urlParams.get('newSolde');
      const statusMessageElement = document.getElementById('statusMessage');

      if (newSolde) {
        try {
          // Récupérer les données utilisateur de localStorage
          const user = JSON.parse(localStorage.getItem('user'));
          if (user) {
            // Mettre à jour le solde
            user.Solde = parseFloat(newSolde);
            // Sauvegarder dans localStorage
            localStorage.setItem('user', JSON.stringify(user));

            console.log("Nouveau solde mis à jour dans localStorage:", user.Solde);

            // Afficher le nouveau solde à l'utilisateur
            statusMessageElement.textContent = `Votre nouveau solde est de : ${parseFloat(newSolde).toFixed(2)} HTG`;
            
            // Nettoyer l'URL pour une meilleure expérience utilisateur
            history.replaceState({}, document.title, window.location.pathname);
          } else {
            console.error('Utilisateur non trouvé dans localStorage.');
            statusMessageElement.textContent = 'Votre paiement a été un succès, mais nous n\'avons pas pu mettre à jour votre solde localement.';
          }
        } catch (error) {
          console.error('Erreur lors de la mise à jour de localStorage:', error);
          statusMessageElement.textContent = 'Une erreur est survenue lors de la mise à jour de votre solde local.';
        }
      } else {
        // Gérer le cas où il n'y a pas de nouveau solde dans l'URL
        console.warn('Aucun nouveau solde trouvé dans l\'URL. Le solde ne sera pas mis à jour.');
        statusMessageElement.textContent = 'Votre paiement a été un succès. Le solde sera mis à jour lors de votre prochaine connexion.';
      }
    }

    // Lancer la fonction au chargement de la page
    window.onload = updateBalanceFromUrl;
  </script>

</body>
</html>

