<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>R√©clamer Bonus</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f7f9fc; padding:20px; }
    .card { background:white; padding:20px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1); max-width:400px; margin:auto; }
    h2 { color:#333; }
    p { font-size:16px; }
    button { padding:10px 20px; border:none; border-radius:8px; background:#28a745; color:white; cursor:pointer; font-size:16px; }
    button:disabled { background:gray; cursor:not-allowed; }
  </style>
</head>
<body>
  <div class="card">
    <h2>üéÅ Bonus Affili√©</h2>
    <p>Nombre d‚Äôaffili√©s : <span id="nbreAffiche">0</span></p>
    <p>Bonus disponible : <span id="bonusMontant">Aucun</span></p>
    <button id="btnBonus" disabled>R√©clamer mon bonus</button>
  </div>

  <script>
    // üéØ Grille des bonus
    const bonusPaliers = [
      { seuil: 5, montant: 250 },
      { seuil: 10, montant: 600 },
      { seuil: 20, montant: 1500 },
      { seuil: 40, montant: 4000 },
      { seuil: 100, montant: 10000 }
    ];

    // üìå R√©cup√©rer nombre affili√©s depuis localStorage
    const nbreAffilie = parseInt(localStorage.getItem("nbreaffilie")) || 0;
    document.getElementById("nbreAffiche").textContent = nbreAffilie;

    // üìå V√©rifier quel bonus correspond
    let bonusTrouve = null;
    for (let palier of bonusPaliers) {
      if (nbreAffilie >= palier.seuil) {
        bonusTrouve = palier;
      }
    }

    if (bonusTrouve) {
      document.getElementById("bonusMontant").textContent = bonusTrouve.montant + " HTG";
      document.getElementById("btnBonus").disabled = false;
    }

    // üìå Action du bouton : envoie la demande au backend
    document.getElementById("btnBonus").addEventListener("click", async () => {
      if (!bonusTrouve) return alert("Aucun bonus disponible");

      const userId = localStorage.getItem("userId"); // identifiant unique affili√©
      if (!userId) return alert("Erreur: utilisateur non identifi√©");

      try {
        const res = await fetch("https://script.google.com/macros/s/TON_SCRIPT_ID/exec", {
          method: "POST",
          body: JSON.stringify({
            action: "bonus",
            userId: userId,
            montant: bonusTrouve.montant
          })
        });

        const data = await res.json();
        if (data.status === "success") {
          alert("üéâ Bonus de " + bonusTrouve.montant + " HTG cr√©dit√© sur ton compte !");
        } else {
          alert("Erreur: " + data.message);
        }
      } catch (err) {
        alert("Erreur r√©seau: " + err.message);
      }
    });
  </script>
</body>
</html>
